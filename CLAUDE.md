# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Running the App

```bash
python main.py
```

## Setup

Dependencies are managed with `uv` (pyproject.toml + uv.lock):

```bash
uv sync
```

Or using the legacy venv:

```bash
pip install -r requirements.txt
```

## Linting and Type Checking

```bash
flake8 .
mypy .
autopep8 --in-place --recursive .
```

## Architecture

This is an interactive CLI tool for managing Bitbucket and GitHub repositories. Entry point is `main.py`, which presents a numbered menu and dispatches to class-based handlers.

**Data sources:**
- `accounts.csv` — Bitbucket account credentials (gitignored; columns: `email`, `workspace`, `project_key`, `username`, `app_password`, `is_private`)
- `.env` — GitHub credentials (`GITHUB_TOKEN`, `GITHUB_USERNAME`)
- `{email}_repos.csv` — Cached repo lists per Bitbucket account (generated by the app)
- `github_repos.csv` — Cached GitHub repo list (generated by the app)

**Key layers:**

- `classes/AccountsCsv.py` — Reads `accounts.csv` and provides account selection via `simple-term-menu`
- `classes/BitbucketApi.py` — Raw HTTP calls to the Bitbucket REST API v2.0 using HTTPBasicAuth
- `classes/Bitbucket.py` — Orchestrates Bitbucket operations (repos to file, clone, create, delete, mirror). Always resolves account credentials from `accounts.csv` before making API calls.
- `classes/GithubClass.py` — Orchestrates GitHub operations using PyGithub and direct HTTP calls. Reads credentials from `.env`.
- `classes/Browser.py` — Opens browser URLs with `webbrowser.open()` for actions requiring manual steps (repo creation, group permissions)
- `modules/git_mirror.py` — Standalone functions for `git clone --mirror` / `git push --mirror` workflows
- `utils.py` — Shared UI helpers: `selectOne` (simple-term-menu), `selectMultiple` (fzf via pyfzf), `pretty_print`, `pretty_table` (rich)
- `views.py` — Higher-level orchestration functions (partially unused; `main.py` mostly instantiates classes directly)
- `my_types/` — `NamedTuple` definitions: `AccountType`, `RepoType`
- `execeptions/` — Custom exceptions: `AccountException`, `BitbucketException`, `BitbucketApiException`, `GithubException` (note: directory name has a typo — keep as-is)

**Typical data flow:**
`AccountsCsv` → `AccountType` → `BitbucketApi(username, app_password)` → API response → write to CSV → fzf selection for subsequent operations.

Operations that create repos on Bitbucket may also open a browser for manual steps (group permissions) via `Browser`.
